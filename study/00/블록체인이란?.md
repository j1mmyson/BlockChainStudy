 ## index

- 블록체인이란?
- 해시함수
- 컨센서스
  - PoW
  - PoS
  - DPoS

## 블록체인이란?

**블록체인**이란 p2p(peer to peer) 네트워크를 통해 관리되는 **분산 데이터베이스**의 한 형태로, 데이터를 담는 장부를 중앙기관(?)에서만 관리하는 형태와는 달리 장부를 네트워크에 속한 모든 사용자에게 나누어 공동으로 기록 및 관리하는 기술을 말한다. 이러한 특성 때문에 블록체인은 **분산원장 기술(DLT)**, **공공 거래장부** 또는 **분산 거래장부**등으로도 불리며 디도스와 같은 해킹의 위험으로부터도 벗어나게 된다. 새로운 데이터가 생기면 `해시`, `이전 블록의 해시값`, `데이터` 등과 같은 정보를 담은 **블록**이 생성되고 이 블록들이 연결(Chain)되어 **블록체인**을 이루게된다.

여기서 네트워크의 참여자 누구나 낮은 비용으로 쉽게 블록을 추가할 수 있다면 악의적으로 조작된 블록을 생성하기 쉬워지고 이 블록들이 네트워크에 전파된다면 블록체인에 대한 신뢰성이 떨어지게되고 그 블록체인은 가치를 잃게될 것이다. 그래서 블록체인에서 **데이터를 추가하기 위해서는 어려운 작업을 수행**하게되는데 이 작업으로 블록체인을 안전하고 일관성있게 만들어준다. 이렇게 악의적인 상황이 생기더라도 안전하고 일관성있는 블록체인을 유지하기위한 상호 검증 과정과 알고리즘을 **컨센서스**라고 한다.

간단하게 전체적인 과정의 예시를 들자면 네트워크에 속한 사용자들이 데이터를 생성하고 교환하며 특정 임계치만큼의 데이터가 쌓이게 되면 그 데이터들로 이루어진 블록이 생성이 만들어지고 사용자들은 그 블록에 신뢰를 부여하기위해 자원 혹은 비용(그래픽카드와 같은 컴퓨팅자원)을 들여 해당 블록의 해시값을 찾는 작업을 하게된다. 당연하게도 더 많은 자원을 지불한 사용자가 블록의 해시값을 찾을 확률이 높을 것이며, 해시값을 찾은 사용자는 보상을 받게된다(이를테면 비트코인). 

## 해시 함수(Hash Function)

**해시 함수**는 데이터가 입력으로 주어졌을 때 해당 데이터를 임의의 고정된 길이의 데이터로 매핑해주는 함수이다. 입력값이 같으면 항상 같은 출력값만 내뱉기 때문에 데이터의 무결성을 보장하기 위해 많이 사용된다. 해시 함수는 아래와 같은 특징들을 갖는다.  

- 같은 입력값에 대해서는 항상 같은 출력값만 내뱉는다.

- 모든 입력값에 대해 항상 고정된 길이의 해시값을 출력해준다.

- 입력값이 아주 조금만 달라도 전혀 다른 출력값을 내뱉는다. 이 특성때문에 감히 해시 함수의 출력을 유추할 수 없다.

  ``` python
  Hash("안녕") # ABDE321
  Hash("암녕") # CG2V3A2
  ```

블록체인에서 한 블록에는 `해당 블록의 해시값`, `이전 블록의 해시값`과 같이 저장되어있을 수 있는데, 아래와 같이 3개의 블록이 연결되어 있다고 가정해보자.  

```
A[data: a, hash: 123, prevHash: 000]
B[data: b, hash: 456, prevHash: 123]
C[data: c, hash: 789, prevHash: 456]
```

이 때 누군가 B블록의 데이터를 조작하게되면 B블록의 해시값 역시 바뀌게 될것이고 `B.hash` != `C.prevHash` 이기 때문에 데이터가 조작된 것을 감지할 수 있다.

## 컨센서스(Consensus)

### PoW (Proof of Work) : 작업증명

PoW는 최초의 블록체인인 비트코인을 창시한 **사토시 나카모토**가 제안한 컨센서스이다. 새로운 블록을 추가하기 위해서는 굉장히 어려운 수학문제를 풀어야하며 **블록 생성 시간동안 가장 많은 해시파워를 제공한 사용자가 블록을 생성**할 수 있다.

#### 장점

- 강력한 보안성을 제공한다.
- 서비스 남용을 쉽게 방지할 수 있다.

#### 단점

- 높은 전력소모를 통해 자원이 낭비된다.
- 지속적으로 해시파워를 유지해야 한다.
- 해싱 난이도가 높아 특정 마이닝 세력의 해시 독점으로 인한 생태계의 교란 우려가 있다.

### PoS(Proof of Stake): 지분증명

PoS는 코인을 보유한 지분율에 따라 새로운 블록을 생성할 수 있는 권한을 받을 수 있는 컨센서스 알고리즘이다. 블록 생성자와 지분 생성자의 이해관계를 일치시켜 악의적인 의도로 블록을 생성할 상황을 배제한다. 

#### 장점

- 해시파워가 많이 필요하지 않아 경제적, 친환경적이다.
- 블록생산자의 탈중앙화로 인한 안정성 확보
  - `PoW에서 51%의 해시파워를 가지는 비용(약 1조)` <<<< `PoS에서 51%의 자산을 가지는 비용(약 100조)`

#### 단점

- 해시파워가 낮기때문에 보안성이 강한지에 대한 여부가 아직 검증되지 않았다.
- 지분이 많은 세력이 권력을 독점할 가능성이 존재한다.

### DPoS(Delegated Proof of Stake): 위임된 지분증명

DPoS는 PoS 컨센서스 알고리즘을 변형한 형태로 네트워크의 모든 사용자들이 자신의 지분을 위임하여 선출된 상위 사용자에게 권한을 위임하는 방식이다. 이렇게 선출된 상위 지분 사용자들을 `증인`이라고 지칭하고 일정 수의 증인들이 모이면 블록 생성을 담당하게된다. 컨센서스에 참여하는 사용자 수가 한정되어있어 빠른 성능과 확장성을 보여주지만, 완전히 탈중앙화된 블록체인이 아니라는 비판을 받기도 한다.

#### 장점

- PoS에 비해 많은 트랜잭션을 빠르게 처리할 수 있다.
- PoW에 비해 비용이 낮다.
- 하드포크의 위험이 낮다.
- 증인들의 투표참여의 인센티브가 확실하다. (?)

#### 단점

- 증인끼리 담합할 위험이 존재한다.
- 뽑는 증인의 수가 한정적이기 때문에 디도스 공격 위험이 존재한다.

### 레퍼런스

##### 1) [민그래머님의 `Go로 구현하는 블록체인`](https://mingrammer.com/tags/blockchain/)  

##### 2) [donekim님의 `컨센서스란 무엇인가?`](https://steemit.com/kr/@donekim/consensus-pow-pos-dpos)  

##### 3) [송범근님의 `5분만에 이해하는 블록체인의 원리`](https://brunch.co.kr/@bumgeunsong/51)





